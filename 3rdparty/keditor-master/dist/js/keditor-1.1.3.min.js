!function(t){var e=function(){"undefined"!=typeof console&&o.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},n=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||n("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||n("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||n("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.");var o=function(e,n){this.options=t.extend({},o.DEFAULTS,n),this.init(e)};o.debug=!0,o.version="1.1.3",o.DEFAULTS={btnMoveContainerText:'<i class="fa fa-sort"></i>',btnMoveComponentText:'<i class="fa fa-arrows"></i>',btnSettingContainerText:'<i class="fa fa-cog"></i>',btnSettingComponentText:'<i class="fa fa-cog"></i>',btnDuplicateContainerText:'<i class="fa fa-files-o"></i>',btnDuplicateComponentText:'<i class="fa fa-files-o"></i>',btnDeleteContainerText:'<i class="fa fa-times"></i>',btnDeleteComponentText:'<i class="fa fa-times"></i>',tabContainersText:"Containers",tabContainersTitle:"Containers",tabComponentsText:"Components",tabComponentsTitle:"Components",tabTooltipEnabled:!0,extraTabs:null,defaultComponentType:"blank",snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",snippetsTooltipEnabled:!0,snippetsTooltipPosition:"left",snippetsFilterEnabled:!0,snippetsCategoriesSeparator:";",iframeMode:!1,contentAreasSelector:null,contentAreasWrapper:'<div class="keditor-content-areas-wrapper container"></div>',containerSettingEnabled:!1,containerSettingInitFunction:null,containerSettingShowFunction:null,containerSettingHideFunction:null,onReady:function(){},onInitFrame:function(t,e,n){},onSidebarToggled:function(t){},onInitContentArea:function(t){},onContentChanged:function(t){},onInitContainer:function(t){},onBeforeContainerDeleted:function(t,e){},onContainerDeleted:function(t,e){},onContainerChanged:function(t,e){},onContainerDuplicated:function(t,e,n){},onContainerSelected:function(t,e){},onContainerSnippetDropped:function(t,e,n){},onComponentReady:function(t){},onInitComponent:function(t){},onBeforeComponentDeleted:function(t,e){},onComponentDeleted:function(t,e){},onComponentChanged:function(t,e){},onComponentDuplicated:function(t,e,n){},onComponentSelected:function(t,e){},onComponentSnippetDropped:function(t,e,n){},onBeforeDynamicContentLoad:function(t,e){},onDynamicContentLoaded:function(t,e,n,o){},onDynamicContentError:function(t,e,n,o){}},o.components={blank:{settingEnabled:!1}},o.log=e,o.error=n,o.prototype={init:function(n){var o=this,i=o.options;if(i.iframeMode)n=o.initFrame(n);else if(o.body=t(document.body),n.is("textarea")){e("Target is textarea",n);var a=n.val(),r=t("<div />"),s=o.generateId("wrapper");n.after(r),r.attr({id:s,"class":"keditor-wrapper"}),e('Id for keditor wrapper is: "'+s+'"'),r.html(a),n.css("display","none"),n.attr("data-keditor-wrapper","#"+s),n=r}var d,c=o.body;c.hasClass("initialized-snippets-list")?e("Snippets list is already initialized!"):(d=o.initSidebar(),c.addClass("initialized-snippets-list")),c.hasClass("initialized-click-event-handlers")?e("CLick event handlers is already initialized!"):(o.initKEditorClicks(),c.addClass("initialized-click-event-handlers")),o.initContentAreas(n),d||"function"!=typeof i.onReady||i.onReady.call(o)},generateId:function(t){var e=(new Date).getTime();return"keditor-"+t+"-"+e},initNiceScroll:function(n){e("initNiceScroll",n),t.fn.niceScroll?(e("Initialize $.fn.niceScroll"),n.niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:"",disablemutationobserver:!0})):e("$.fn.niceScroll does not exist. Use default sidebar.")},initFrame:function(n){e("initFrame",n);var i=this,a=i.options,r=n.html(),s=t("<iframe />"),d=i.generateId("frame");n.after(s),s.attr({id:d,"class":"keditor-frame"}),e('Id for keditor frame is: "'+d+'"'),n.css("display","none"),n.attr("data-keditor-frame","#"+d);var c=s.contents(),l=c.find("head"),p=c.find("body");e("Adding styles to iframe...");var f="";t('[data-type="keditor-style"]').each(function(){var e=t(this),n=e.attr("href")||e.attr("data-href")||"";f+=n?'<link rel="stylesheet" type="text/css" href="'+n+'" />\n':'<style type="text/css">'+e.html()+"</style>\n"}),e("Styles: \n"+f),l.append(f),e("All styles are added"),e("Adding original content to iframe...");var g;return a.contentAreasWrapper?(g=t(a.contentAreasWrapper),p.append(g),g.html(r)):p.html(r),a.snippetsListId=o.DEFAULTS.snippetsListId,i.body=p,"function"==typeof a.onInitFrame&&a.onInitFrame.call(s,s,l,p),g||p},initSidebar:function(){e("initSidebar");var i=this,a=i.options,r=i.body;return r.addClass("opened-keditor-sidebar"),a.snippetsListId===o.DEFAULTS.snippetsListId?(e("Render default KEditor snippet container"),r.append('<div id="keditor-sidebar">   <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>   <div id="keditor-snippets-list"></div>   <div id="keditor-snippets-content" style="display: none"></div>   <div id="keditor-setting-panel">       <div id="keditor-setting-header"><span id="keditor-setting-title"></span><a href="#" id="keditor-setting-closer"><i class="fa fa-arrow-right"></i></a></div>       <div id="keditor-setting-body"><div id="keditor-setting-forms"></div></div>   </div></div>'),i.initSidebarToggler()):(e('Render KEditor snippets content after custom snippets list with id="'+a.snippetsListId+'"'),r.find("#"+a.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof a.snippetsUrl&&a.snippetsUrl.length>0?(e('Getting snippets form "'+a.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:a.snippetsUrl,success:function(t){e("Success in getting snippets",t),i.renderSnippets(t),i.initSnippets(),i.initTabs(),i.initTabsSwitcher(),i.initSettingPanel(),a.snippetsFilterEnabled&&(i.initSnippetsFilter("Container"),i.initSnippetsFilter("Component")),(a.snippetsTooltipEnabled||a.tabTooltipEnabled)&&(e("Initialize Bootstrap tooltip plugin"),r.find("#"+a.snippetsListId).find('[data-toggle="tooltip"]').tooltip()),"function"==typeof a.onReady&&a.onReady.call(i)},error:function(t){e("Error when getting snippets",t)}})):void n('"snippetsUrl" must be not null!')},initSnippetsFilter:function(n){e("initSnippetsFilter");var o=this,i=o.options,a=o.body,r=n.toLowerCase(),s=o["snippets"+n+"Categories"],d="";d+='<div id="keditor-'+r+'-snippets-filter-wrapper" class="keditor-snippets-filter-wrapper">',d+='     <select id="keditor-'+r+'-snippets-filter" class="keditor-snippets-filter">',d+='         <option value="" selected="selected">All</option>';for(var c=0;c<s.length;c++)d+='     <option value="'+s[c]+'">'+s[c]+"</option>";d+="     </select>",d+="</div>";var l=a.find("#keditor-"+r+"-snippets-tab"),p=l.find(".keditor-snippet");l.prepend(d),p.each(function(){var e=t(this),n=e.attr("data-categories")||"";n=n.split(i.snippetsCategoriesSeparator),e.data("categories",n)}),l.find(".keditor-snippets-filter").on("change",function(){var e=this.value;e?p.filter(function(){var n=t(this),o=!1,i=n.data("categories");return-1!==t.inArray(e,i)&&(o=!0),n[o?"removeClass":"addClass"]("not-matched"),o}):p.removeClass("not-matched")})},toggleSidebar:function(t){e("toggleSidebar",t);var n=this,o=n.options,i=n.body,a=i.find("#keditor-sidebar-toggler i");t?(i.addClass("opened-keditor-sidebar"),a.attr("class","fa fa-chevron-right")):(i.removeClass("opened-keditor-sidebar"),a.attr("class","fa fa-chevron-left")),"function"==typeof o.onSidebarToggled&&o.onSidebarToggled.call(null,t)},initSidebarToggler:function(){e("initSidebarToggler");var t=this,n=t.body;n.find("#keditor-sidebar-toggler").on("click",function(e){e.preventDefault(),t.toggleSidebar(!n.hasClass("opened-keditor-sidebar"))})},renderSnippets:function(n){e("renderSnippets",n);var o=this,i=o.options,a=o.body,r="",s="",d="";o.snippetsContainerCategories=[],o.snippetsComponentCategories=[],t("<div />").html(n).find("> div").each(function(n){var a=t(this),c=a.html().trim(),l=a.attr("data-preview"),p=a.attr("data-type"),f=a.attr("data-title"),g="",C=a.attr("data-categories")||"";e("Snippet #"+n+" type="+p+" categories="+C,l,c),g+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+n+'" data-type="'+p+'" '+(i.snippetsTooltipEnabled?'data-toggle="tooltip" data-placement="'+i.snippetsTooltipPosition+'"':"")+' title="'+f+'" data-categories="'+C+'">',g+='   <img class="keditor-snippet-preview" src="'+l+'" />',g+="</section>",C=C.split(i.snippetsCategoriesSeparator),"container"===p?(r+=g,o.snippetsContainerCategories=o.snippetsContainerCategories.concat(C)):-1!==p.indexOf("component")&&(s+=g,o.snippetsComponentCategories=o.snippetsComponentCategories.concat(C));var m=o.getDataAttributes(a,["data-preview","data-type","data-title"],!0);d+='<script id="keditor-snippet-'+n+'" type="text/html" '+m.join(" ")+">"+c+"</script>"}),o.snippetsContainerCategories=o.beautifyCategories(o.snippetsContainerCategories),o.snippetsComponentCategories=o.beautifyCategories(o.snippetsComponentCategories),a.find("#"+i.snippetsListId).html('<ul id="keditor-snippets-type-switcher" class="nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets-tab"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom"':"")+' title="'+i.tabContainersTitle+'">'+i.tabContainersText+'</a></li>    <li><a href="#keditor-component-snippets-tab"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom"':"")+' title="'+i.tabComponentsTitle+'">'+i.tabComponentsText+'</a></li></ul><div id="keditor-snippets-container" class="tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets-tab"><div class="keditor-snippets-inner">'+r+'</div></div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets-tab"><div class="keditor-snippets-inner">'+s+"</div></div></div>").addClass("loaded-snippets"),a.find("#keditor-snippets-content").html(d)},beautifyCategories:function(n){e("beautifyCategories",n);for(var o=[],i=0;i<n.length;i++){var a=n[i]||"";""!==a&&-1===t.inArray(a,o)&&o.push(a)}return o.sort()},initSnippets:function(){e("initSnippets");var n=this,o=n.options,i=n.body,a=i.find("#"+o.snippetsListId);e("Initialize $.fn.draggable for container snippets list"),a.find(".keditor-snippet[data-type=container]").draggable({helper:"clone",revert:"invalid",connectToSortable:i.find(".keditor-content-area"),start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")},stop:function(){a.find(".keditor-snippet[data-type^=component]").draggable("option","connectToSortable",i.find(".keditor-container-content"))}}),a.find(".keditor-snippet[data-type^=component]").draggable({helper:"clone",revert:"invalid",connectToSortable:i.find(".keditor-container-content"),start:function(){i.find("[contenteditable]").blur(),i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.addClass("highlighted-container-content")},stop:function(){i.removeClass("highlighted-container-content")}})},initTabs:function(){e("initTabs");var n=this,o=n.body,i=n.options,a=o.find("#keditor-snippets-type-switcher"),r=o.find("#keditor-snippets-container");if(i.extraTabs&&t.isPlainObject(i.extraTabs)){e("Add extra tabs",i.extraTabs);for(var s in i.extraTabs){var d=i.extraTabs[s];a.append('<li><a href="#keditor-extra-tab-'+s+'"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom" title="'+d.title+'"':"")+">"+d.text+"</a></li>"),r.append('<div class="tab-pane keditor-snippets" id="keditor-extra-tab-'+s+'"><div class="keditor-snippets-inner">'+d.content+"</div></div>")}}n.initNiceScroll(r.find(".keditor-snippets-inner"))},initTabsSwitcher:function(){e("initTabsSwitcher");var n=this,o=n.body,i=o.find("#keditor-snippets-type-switcher li"),a=o.find("#keditor-snippets-container .tab-pane");i.find("a").on("click",function(e){e.preventDefault();var n=t(this),r=n.parent(),s=n.attr("href");if(!r.hasClass("active")){var d=i.filter(".active"),c=a.filter(".active"),l=o.find(s);if(d.removeClass("active"),c.removeClass("active"),r.addClass("active"),l.addClass("active"),t.fn.niceScroll){c.getNiceScroll().hide();var p=l.getNiceScroll();p.show(),p.resize()}}})},initSettingPanel:function(){e("initSettingPanel");var o=this,i=o.options,a=o.body;a.find("#keditor-setting-closer").on("click",function(t){t.preventDefault(),o.hideSettingPanel()});var r=a.find("#keditor-setting-forms");if(o.initNiceScroll(r),i.containerSettingEnabled===!0)if("function"==typeof i.containerSettingInitFunction){var s=t('<div id="keditor-container-setting" class="keditor-setting-form clearfix"></div>');r.append(s),e("Initialize container setting panel"),i.containerSettingInitFunction.call(o,s,o)}else n('"containerSettingInitFunction" is not function!')},setSettingContainer:function(t){e("setSettingContainer",t);var n=this,o=n.body;if(t){var i=t.attr("id");o.attr("data-setting-container",i)}else o.removeAttr("data-setting-container")},getSettingContainer:function(){e("getSettingContainer");var t=this,n=t.body,o=n.attr("data-setting-container");return n.find("#"+o)},setSettingComponent:function(t){e("setSettingComponent",t);var n=this,o=n.body;if(t){var i=t.attr("id");o.attr("data-setting-component",i)}else o.removeAttr("data-setting-component")},getSettingComponent:function(){e("getSettingComponent");var t=this,n=t.body,o=n.attr("data-setting-component");return n.find("#"+o)},showSettingPanel:function(n){e("showSettingPanel",n);var i=this,a=i.options,r=i.body,s=n.is(".keditor-component"),d=r.find("#keditor-setting-forms").children(".active");if(d.removeClass("active"),s){i.setSettingComponent(n),i.setSettingContainer(null);var c=i.getComponentType(n),l=o.components[c];r.find("#keditor-setting-title").html(l.settingTitle);var p=r.find("#keditor-setting-forms"),f=r.find("#keditor-setting-"+c);if(0===f.length){var l=o.components[c];if("function"==typeof l.initSettingForm){f=t('<div id="keditor-setting-'+c+'" data-type="'+c+'" class="keditor-setting-form clearfix active"></div>');var g=t("<span />").html("Loading...");p.append(f),f.append(g),e('Initializing setting form for component type "'+c+'"');var C=l.initSettingForm.call(l,f,i);t.when(C).done(function(){e('Initialized setting form for component type "'+c+'"'),setTimeout(function(){g.remove(),"function"==typeof l.showSettingForm?(e('Show setting form of component type "'+c+'"'),l.showSettingForm.call(l,f,n,i)):e('"showSettingForm" function of component type "'+c+'" does not exist')},100)})}else e('"initSettingForm" function of component type "'+c+'" does not exist')}else"function"==typeof l.showSettingForm?(e('Show setting form of component type "'+c+'"'),l.showSettingForm.call(l,f,n,i)):e('"showSettingForm" function of component type "'+c+'" does not exist'),f.addClass("active")}else{i.setSettingContainer(n),i.setSettingComponent(null),r.find("#keditor-setting-title").html("Container Settings");var f=r.find("#keditor-container-setting");"function"==typeof a.containerSettingShowFunction?(e("Show setting form of container"),a.containerSettingShowFunction.call(i,f,n,i)):e('"containerSettingShowFunction" does not exist'),f.addClass("active")}i.toggleSidebar(!0),r.addClass("opened-keditor-setting")},hideSettingPanel:function(){e("hideSettingPanel");var t=this,n=t.options,i=t.body;i.removeClass("opened-keditor-setting");var a=i.find("#keditor-setting-forms").children(".active");if(a.length>0){if(a.is("#keditor-container-setting"))"function"==typeof n.containerSettingHideFunction?(e("Hide setting form of container"),n.containerSettingHideFunction.call(t,a,t)):e('"containerSettingHideFunction" does not exist');else{var r=a.attr("data-type"),s=o.components[r];"function"==typeof s.hideSettingForm?(e('Hide setting form of component type "'+r+'"'),s.hideSettingForm.call(s,a,t)):e('"hideSettingForm" function of component type "'+r+'" does not exist')}a.removeClass("active")}i.removeClass("opened-keditor-setting"),t.setSettingComponent(null),t.setSettingContainer(null)},getContentAreas:function(n){e("getContentAreas",n);var o,i=this,a=i.options;if(a.contentAreasSelector&&(o=n.find(a.contentAreasSelector)),!o||0===o.length){e("Do not find any content area. Creating default content area..."),o=t("<div />");var r=n.html();o.html(r),n.empty().append(o)}return o},initContentAreas:function(n){e("initContentAreas",n);var o=this,i=o.getContentAreas(n);i.each(function(){var n=t(this),i=n.attr("id")||"";0===i.length&&(e("Content area does not contain Id. Generating id for content area..."),i=o.generateId("content-area"),n.attr("id",i),e('Id for content are is: "'+i+'"')),o.initContentArea(n),n.data("keditor",o)})},initContentArea:function(n){e("initContentArea",n);var o=this,i=o.options,a=o.body;if(n.addClass("keditor-content-area"),e("Initialize $.fn.droppable for content area"),n.droppable({accept:".keditor-snippet[data-type=container]",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for content area"),n.sortable({handle:".btn-container-reposition",items:"> section",connectWith:".keditor-content-area",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(r,s){e("On received snippet",r,s);var d=s.helper,c=s.item;if(c.is(".keditor-snippet")){var l=a.find(c.attr("data-snippet")).html();e("Snippet content",l);var p=t('<section class="keditor-container">   <section class="keditor-container-inner">'+l+"</section></section>");d.replaceWith(p),p.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),p.addClass("showed-keditor-toolbar")),"function"==typeof i.onContainerSnippetDropped&&i.onContainerSnippetDropped.call(n,r,p,s.item),o.initContainer(n,p)}o.hideSettingPanel(),"function"==typeof i.onContentChanged&&i.onContentChanged.call(n,r)}}),e("Initialize existing containers in content area"),n.children("section").each(function(){o.convertToContainer(n,t(this))}),"function"==typeof i.onInitContentArea){var r=i.onInitContentArea.call(n,n);r&&r.length>0&&t.each(r,function(){o.convertToContainer(n,t(this))})}},convertToContainer:function(t,n){e("convertToContainer",t,n);var o,i=this,a=n.is("section");a?(n.addClass("keditor-container"),n.wrapInner('<section class="keditor-container-inner"></section>'),o=n):(n.wrap('<section class="keditor-container"><section class="keditor-container-inner"></section></section>'),o=n.parent().parent()),i.initContainer(t,o)},initContainer:function(n,o){e("initContainer",n,o);var i=this,a=i.options;if(o.hasClass("keditor-initialized-container")&&o.hasClass("keditor-initializing-container"))e(o.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{o.addClass("keditor-initializing-container");var r="";a.containerSettingEnabled===!0&&(r='<a href="#" class="btn-container-setting">'+a.btnSettingContainerText+"</a>"),e("Render KEditor toolbar for container",o),o.append('<div class="keditor-toolbar keditor-toolbar-container">   <a href="#" class="btn-container-reposition">'+a.btnMoveContainerText+"</a>"+r+'   <a href="#" class="btn-container-duplicate">'+a.btnDuplicateContainerText+'</a>   <a href="#" class="btn-container-delete">'+a.btnDeleteContainerText+"</a></div>");var s=i.generateId("container");e("Id for container is: "+s),o.attr("id",s);var d=o.find('[data-type="container-content"]');e("Initialize "+d.length+" container content(s)"),d.each(function(){var e=t(this);i.initContainerContent(n,o,e)}),"function"==typeof a.onInitContainer&&a.onInitContainer.call(n,o),o.addClass("keditor-initialized-container"),o.removeClass("keditor-initializing-container")}},initContainerContent:function(n,o,i){e("initContainerContent",n,o,i);var a=this,r=a.options,s=a.body,d=a.generateId("container-content");i.addClass("keditor-container-content"),e("Id for container content id: "+d,i),i.attr("id",d),e("Initialize $.fn.droppable for container content"),i.droppable({accept:".keditor-snippet[data-type=component]",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for container content"),i.sortable({handle:".btn-component-reposition",items:"> section",connectWith:".keditor-container-content",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(o,i){e("On received snippet",o,i);var d,c=i.helper,l=i.item;if(l.is(".keditor-snippet")){var p=s.find(l.attr("data-snippet")),f=p.html(),g=l.attr("data-type");e("Snippet content",f);var C=a.getDataAttributes(p,null,!0),m=t('<section class="keditor-component" data-type="'+g+'" '+C.join(" ")+'>   <section class="keditor-component-content">'+f+"</section></section>");c.replaceWith(m),d=m.closest(".keditor-container"),"function"==typeof r.onComponentSnippetDropped&&r.onComponentSnippetDropped.call(n,o,m,i.item),a.initComponent(n,d,m)}else d=l.closest(".keditor-container");d.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),d.addClass("showed-keditor-toolbar")),"function"==typeof r.onContainerChanged&&r.onContainerChanged.call(n,o,d),"function"==typeof r.onContentChanged&&r.onContentChanged.call(n,o)}}),e("Initialize existing components inside container content"),i.children().each(function(){var e=t(this);a.convertToComponent(n,o,e,!0)})},convertToComponent:function(t,n,o,i){e("convertToComponent",t,n,o,i);var a,r=this,s=o.is("section");s?(o.addClass("keditor-component"),o.wrapInner('<section class="keditor-component-content"></section>'),a=o):(o.wrap('<section class="keditor-component"><section class="keditor-component-content"></section></section>'),a=o.parent().parent()),i&&a.addClass("existing-component"),r.initComponent(t,n,a)},getDataAttributes:function(n,o,i){e("getDataAttributes",n,o,i);var a=i?[]:{};return o||(o=[]),t.each(n.get(0).attributes,function(e,n){0===n.name.indexOf("data-")&&-1===t.inArray(n.name,o)&&(i?a.push(n.name+'="'+n.value+'"'):a[n.name]=n.value)}),a},getComponentType:function(t){e("getComponentType",t);var i=this,a=i.options,r=t.attr("data-type"),s=r?r.replace("component-",""):"";return s&&s in o.components?s:(e(s?'Component type "'+s+'" does not exist':"This component does not contain data-type attribute"),"string"==typeof a.defaultComponentType?s=a.defaultComponentType:"function"==typeof a.defaultComponentType&&(s=a.defaultComponentType.call(t,t)),s||n("Component type is undefined!"),e("Fallback to defaultComponentType: "+s),s)},initComponent:function(n,i,a){e("initComponent",n,i,a);var r=this,s=r.options,d=r.body;if(a.hasClass("keditor-initialized-component")&&a.hasClass("keditor-initializing-component"))e(a.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{a.addClass("keditor-initializing-component");var c=r.generateId("component");e("Id for component is: "+c),a.attr("id",c);var l=a.children(".keditor-component-content"),p=r.generateId("component-content");e("Id for component content is: "+p),l.attr("id",p);var f=r.getComponentType(a);e("Component type: "+f);var g=o.components[f],C=g.settingEnabled,m="";C&&(m='<a href="#" class="btn-component-setting">'+s.btnSettingComponentText+"</a>"),e("Render KEditor toolbar for component",a),a.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="#" class="btn-component-reposition">'+s.btnMoveComponentText+"</a>"+m+'   <a href="#" class="btn-component-duplicate">'+s.btnDuplicateComponentText+'</a>   <a href="#" class="btn-component-delete">'+s.btnDeleteComponentText+"</a></div>");var h=[];a.find("[data-dynamic-href]").each(function(){var e=t(this);h.push(r.initDynamicContent(e))}),t.when.apply(null,h).then(function(){"function"==typeof g.init?g.init.call(g,n,i,a,r):(d.removeClass("highlighted-container-content"),e('"init" function of component type "'+f+'" does not exist')),"function"==typeof s.onInitComponent&&s.onInitComponent.call(n,a),a.addClass("keditor-initialized-component"),a.removeClass("keditor-initializing-component")})}},getClickedElement:function(e,n){var o=t(e.target),i=o.closest(n);return o.is(n)?o:i.length>0?i:null},initKEditorClicks:function(){e("initKEditorClicks");var n=this,o=n.options,i=n.body;i.on("click",function(t){var a=n.getClickedElement(t,"#keditor-sidebar"),r=n.getClickedElement(t,".keditor-container");if(r){if(e("Click on .keditor-container",r),!r.hasClass("showed-keditor-toolbar")){i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),r.addClass("showed-keditor-toolbar");var s=r.parent();"function"==typeof o.onContainerSelected&&o.onContainerSelected.call(s,t,r)}}else a||(i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"));var d=n.getClickedElement(t,".keditor-component");if(d){if(e("Click on .keditor-component",d),!d.hasClass("showed-keditor-toolbar")){i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),d.addClass("showed-keditor-toolbar");var s=d.parent();"function"==typeof o.onComponentSelected&&o.onComponentSelected.call(s,t,d)}}else a||i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),i.on("click",".btn-container-setting",function(o){o.preventDefault();var a=t(this);e("Click on .btn-container-setting",a);var r=a.closest(".keditor-container");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(n.getSettingContainer())?n.hideSettingPanel():n.showSettingPanel(r)}),i.on("click",".btn-container-duplicate",function(a){a.preventDefault();var r=t(this);e("Click on .btn-container-duplicate",r);var s=r.closest(".keditor-container"),d=s.parent(),c=t(n.getContainerContent(s));s.after(c),n.convertToContainer(d,c);var l=i.find("#"+o.snippetsListId),p=l.find(".keditor-snippet[data-type^=component]"),f=p.draggable("option","connectToSortable");p.draggable("option","connectToSortable",f.add(c.find(".keditor-container-content"))),e("Container is duplicated"),"function"==typeof o.onContainerDuplicated&&o.onContainerDuplicated.call(d,s,c),"function"==typeof o.onContentChanged&&o.onContentChanged.call(d,a)}),i.on("click",".btn-container-delete",function(i){i.preventDefault();var a=t(this);if(e("Click on .btn-container-delete",a),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var r=a.closest(".keditor-container"),s=r.find(".keditor-component"),d=r.parent();"function"==typeof o.onBeforeContainerDeleted&&o.onBeforeContainerDeleted.call(d,i,r);var c=n.getSettingComponent();if(c){var l=c.closest(".keditor-container");l.is(r)&&(e("Deleting container is container of setting container. Close setting panel for this setting component",c),n.hideSettingPanel())}else n.getSettingContainer().is(r)&&(e("Deleting container is setting container. Close setting panel for this container",r),n.hideSettingPanel());s.length>0&&s.each(function(){n.deleteComponent(t(this))}),r.remove(),"function"==typeof o.onContainerDeleted&&o.onContainerDeleted.call(d,i,r),"function"==typeof o.onContentChanged&&o.onContentChanged.call(d,i)}}),i.on("click",".btn-component-setting",function(o){o.preventDefault();var a=t(this);e("Click on .btn-component-setting",a);var r=a.closest(".keditor-component");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(n.getSettingComponent())?n.hideSettingPanel():n.showSettingPanel(r)}),i.on("click",".btn-component-duplicate",function(i){i.preventDefault();var a=t(this);e("Click on .btn-component-duplicate",a);var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=s.parent(),c=t(n.getComponentContent(r));r.after(c),n.convertToComponent(d,s,c),e("Component is duplicated"),"function"==typeof o.onComponentDuplicated&&o.onComponentDuplicated.call(d,r,c),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(d,i,s),"function"==typeof o.onContentChanged&&o.onContentChanged.call(d,i)}),i.on("click",".btn-component-delete",function(i){i.preventDefault();var a=t(this);if(e("Click on .btn-component-delete",a),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var r=a.closest(".keditor-component"),s=r.closest(".keditor-content-area");"function"==typeof o.onBeforeComponentDeleted&&o.onBeforeComponentDeleted.call(s,i,r),n.getSettingComponent().is(r)&&n.hideSettingPanel(),n.deleteComponent(r),"function"==typeof o.onComponentDeleted&&o.onComponentDeleted.call(s,i,r),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(s,i,r),"function"==typeof o.onContentChanged&&o.onContentChanged.call(s,i)}})},deleteComponent:function(t){e("deleteComponent",t);var n=this,i=n.getComponentType(t),a=o.components[i];"function"==typeof a.destroy?a.destroy.call(a,t,n):e('"destroy" function of component type "'+i+'" does not exist'),t.remove()},initDynamicContent:function(n){e("initDynamicContent",n);var o=this,i=o.options,a=n.closest(".keditor-component"),r=n.closest(".keditor-content-area");"function"==typeof i.onBeforeDynamicContentLoad&&i.onBeforeDynamicContentLoad.call(r,n,a);var s=n.attr("data-dynamic-href"),d=o.getDataAttributes(a,["data-type","data-dynamic-href"],!1);return d=t.param(d),e("Dynamic href: "+s,"Data: "+d),t.ajax({url:s,data:d,type:"GET",dataType:"HTML",success:function(t,o,a){e("Dynamic content is loaded",n,t,o,a),n.html(t),"function"==typeof i.onDynamicContentLoaded&&i.onDynamicContentLoaded.call(r,n,t,o,a)},error:function(t,o,a){e("Error when loading dynamic content",n,t,o,a),"function"==typeof i.onDynamicContentError&&i.onDynamicContentError.call(r,n,t,o,a)}})},getComponentContent:function(n){e("getComponentContent",n);var i,a=this,r=a.getComponentType(n),s=o.components[r],d=a.getDataAttributes(n,null,!0);if("function"==typeof s.getContent)i=s.getContent.call(s,n,a);else{e('"getContent" function of component type "'+r+'" does not exist. Using default getContent method');var c=n.children(".keditor-component-content");i=c.html()}var l=t("<div />").html(i);return l.find("[data-dynamic-href]").each(function(){t(this).html("")}),i=l.html(),"<section "+d.join(" ")+">"+i+"</section>"},getContainerContent:function(n){e("getContainerContent",n);var o=this,i=(o.options,n.children(".keditor-container-inner").clone());return i.find("[data-type=container-content]").each(function(){var e=t(this);e.removeClass("keditor-container-content ui-droppable ui-sortable").removeAttr("id"),e.children(".keditor-component").each(function(){var e=t(this);e.replaceWith(o.getComponentContent(e))})}),"<section>"+i.html()+"</section>"}};var i={__init:function(n){return t(this).each(function(){var i=t(this);if(i.data("keditor"))e("KEditor is already initialized!");else{e("Initialze KEditor",i,n);var a=new o(i,n);i.data("keditor",a)}})},getContent:function(e){var n=t(this),o=n.data("keditor"),i=o.options,a=[];return n=i.iframeMode?o.body:n,n.find(".keditor-content-area").each(function(){var e="";t(this).children(".keditor-container").each(function(){var n=t(this);e+=o.getContainerContent(n,i)}),a.push(e)}),e?a:a.join("\n")},getOptions:function(){var e=t(this).data("keditor");return e.options}};t.keditor=o,t.fn.keditor=function(t){return i[t]&&"init"!==t?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void n("Method "+t+" does not exist on $.fn.keditor"):i.__init.apply(this,arguments);
}}(jQuery);
//# sourceMappingURL=keditor-1.1.3.min.js.map
